# nwu-dj小程序设计

## 页面设计

### 页面列表

![image-20200722153148704](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722153148704.png)

### 班次列表/首页

![image-20200722154058873](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722154058873.png)

| 元素             | 说明                                                   |
| ---------------- | ------------------------------------------------------ |
| 下方TabBar       | 用于在‘我的’和‘首页’之间切换                           |
| 右下ActiveButton | 切换到发布班次页面（仅秘书、管理员可见）               |
| 主体：班次列表   | 展示可选班次，下拉刷新，触底加载，点击切换到班次详情页 |

### 我的

![image-20200722154315721](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722154315721.png)

| 元素               | 说明                                                   |
| ------------------ | ------------------------------------------------------ |
| 下方TabBar         | 用于在‘我的’和‘首页’之间切换                           |
| 右下ActiveButton   | 扫码签到，扫到码之后展示签到结果                       |
| 主体：已抢班次列表 | 展示已抢班次，下拉刷新，触底加载，点击切换到对应详情页 |

### 班次详情

![image-20200722160036528](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722160036528.png)

| 元素         | 说明                                             |
| ------------ | ------------------------------------------------ |
| 班次信息     | 展示班次信息                                     |
| 抢班按钮     | 切换到抢班页面（仅在当前未抢时显示）             |
| 换班按钮     | 切换到换班页面（仅在当前已抢时显示）             |
| 排班按钮     | 切换到排班页面（仅在身份为秘书、管理员时显示）   |
| 值班成员列表 | 显示已经抢班的社员列表和他们的值班时段，下拉刷新 |

### 发布班次

![image-20200722165246319](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722165246319.png)

| 元素           | 说明                               |
| -------------- | ---------------------------------- |
| 活动标题文本框 | 20字以内                           |
| 活动地点文本框 | 20字以内                           |
| 活动日期       | 选择活动日期                       |
| 开始时间       | 选择活动开始时间                   |
| 结束时间       | 选择活动结束时间                   |
| 人数上限       | 设定同时值班的最大人数，只能是数字 |
| 提交按钮       | 提交发布班次的表单，显示发布结果   |

### 抢班、换班、排班页面

![image-20200722165720489](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722165720489.png)

每个页面都有对应的表单元素，点击按钮即提交表单，然后显示提交结果。

### 登录

![image-20200723154044592](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200723154044592.png)

点击登陆后, 获取用户信息, 成功后调用wx.login, 获取jscode后发送登录请求, payload包括用户昵称, 头像链接和jscode, 根据返回信息判断是否绑定过, 如果绑定过则返回, 未绑定则切到绑定页面，退出绑定视为登录失败

### 绑定

![image-20200723160539471](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200723160539471.png)

包含工号和学号表单, 点击提交会调用绑定接口

## 视图组件

| 组件                                                         | 说明                       | 参数                            | 描述                                   |
| ------------------------------------------------------------ | -------------------------- | ------------------------------- | -------------------------------------- |
| ![image-20200722171029559](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722171029559.png) | DjActiveButton，主操作按钮 | type                            | 跳转至指定页面                         |
| ![image-20200722171327458](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722171327458.png) | DjJobButton，班次信息按钮  | title、description、hint、jobId | 跳转至指定班次的详情页                 |
| ![image-20200722171610002](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722171610002.png) | DjUserInfo，个人信息栏     | avatarUrl、title、description   | 无                                     |
| ![image-20200722171726308](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200722171726308.png) | DjTextField，文本框        | value、label、hint              | model绑定value                         |
| ![image-20200723103606521](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200723103606521.png) | DjPicker，选择器           | value、range                    | model绑定value                         |
|                                                              | DjDatePicker，日期选择器   | value、start、end               | model绑定value，日期格式为“YYYY-MM-DD” |
|                                                              | DjTimePicker，时间选择器   | value、start、end               | model绑定value，时间格式为“HH:mm”      |
| ![image-20200723104526394](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200723104526394.png) | DjDutyLabel，值班员指示器  | avatarUrl、title、description   | 无                                     |
| ![image-20200723104605187](%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1.assets/image-20200723104605187.png) | DjJobHeader，班次标题      | title、description              | 无                                     |

## 逻辑组件

### alert.js

封装`wx.showToast`，`wx.showLoading`，对外提供`success`、`fail`、`loading`三种提示，简化原生API用法。

### http.js

封装`wx.request`，实现请求拦截、Url Base、加载Toast。

对各状态码处理如下：

| 状态码 | 动作                       |
| ------ | -------------------------- |
| 200    | 放行，若有res.msg，alert。 |
| 400    | alert(res.data)            |
| 401    | alert("未登录")，切登录页  |
| 403    | alert("请求未授权")        |
| 500    | alert("服务器未知错误")    |

