# nwu-dj小程序服务端接口设计

## 概要

- 所有接口使用原生http，TLS封包、解包交给反代nginx
- 所有接口路径前缀为`/api/`
- 除非必要，所有接口作认证、授权处理
- GET方法参数写在query string里，POST方法参数写在请求体里，JSON表示

## 访问控制

使用基于角色的权限控制：

- USER：普通用户
- EMPLOYEE：DJ社员
- SECRETARY：秘书
- ADMIN：管理员

## 接口列表

### 公有接口

路径：`/api/public/`

| 名称        | 方法 | 描述              | 权限 |
| ----------- | ---- | ----------------- | ---- |
| login       | POST | 登录              | 无   |
| admin_login | POST | 管理后台Oauth登录 | 无   |

### 私有接口

路径：`/api/private/`

| 名称                | 方法 | 描述             | 权限      |
| ------------------- | ---- | ---------------- | --------- |
| get_active_job_list | GET  | 获取活动班次列表 | EMPLOYEE  |
| get_my_job_list     | GET  | 获取已抢班次列表 | EMPLOYEE  |
| get_job_detail      | GET  | 获取班次详情     | EMPLOYEE  |
| add_job             | POST | 发布班次         | SECRETARY |
| apply_job           | POST | 申请抢班         | EMPLOYEE  |
| exchange_job        | POST | 申请换班         | EMPLOYEE  |
| arrange_job         | POST | 申请排班         | SECRETARY |
| bind_wechat         | POST | 绑定微信         | USER      |

### 管理接口

路径：`/api/admin/`

| 名称                   | 方法 | 描述                                       | 权限      |
| ---------------------- | ---- | ------------------------------------------ | --------- |
| get_job_record_list    | GET  | 获取值班信息（排序、分页、查找、日期筛选） | SECRETARY |
| update_job_record      | POST | 修改值班信息                               | SECRETARY |
| export_job_record      | GET  | 导出值班信息（日期筛选）                   | SECRETARY |
| get_salary_list        | GET  | 获取工资列表（排序、分页、查找、日期筛选） | SECRETARY |
| export_salary_list     | GET  | 导出工资列表（日期筛选）                   | SECRETARY |
| get_job_exchange_list  | GET  | 获取换班记录（排序、分页、查找、日期筛选） | SECRETARY |
| get_user_list          | GET  | 获取用户列表（排序、分页、查找、日期筛选） | SECRETARY |
| import_user_list       | POST | 上传并导入用户列表                         | ADMIN     |
| export_user_list       | GET  | 导出用户列表                               | ADMIN     |
| get_user_list_template | GET  | 下载导入模板                               | USER      |
| update_user            | POST | 修改用户信息                               | ADMIN     |
| delete_user            | POST | 删除用户                                   | ADMIN     |
| insert_user            | POST | 添加用户                                   | ADMIN     |

